#include "mosasaurus.hpp"

using namespace Dino;

MosaApp *MosaApp::app = nullptr;

MosaApp::MosaApp()
{
    this->startupLogo();
    std::cout << "App Init" << std::endl;
}

MosaApp *MosaApp::getInstance()
{
    if (!app)
    {
        app = new MosaApp();
    }
    return app;
}

Mongoose::Server *MosaApp::getServerInstance()
{
    if (this->server)
    {
        return this->server;
    }
    else
    {
        std::invalid_argument("Server uninitialized");
        return nullptr;
    }
}

void MosaApp::startupLogo()
{
    std::string logo = "░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▓▓▓▒░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▓▒▒▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░▒░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▓▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░▒▓▓▓░░░▒▒▓▓▓▒░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░▒▓▓▓▓▒▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▒▓▒▒▓▒▒▒▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░▓▓▓▒░▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▓▒▒▒▒▒▒▓▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▓▓▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▓▒▒▓▒░░░░░░░░░░░░░░▒░░░░\n\
░░░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▓▓▒▓▒▒▒▒▓▓▓▓▓▓▓▒▒▓▒░▒▓▒▒▓▓▓▓▒░░░\n\
░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓░░░\n\
░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░░░\n\
░░░░░▒▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒▒▒▓▓▒▒░░░░░░░░░\n\
░░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▒░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░░░░░░░░░░░░░░░\n\
░░░░▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░\n\
░░░░▒▓▓▓▓▓▓▓▓▓░░░░░░░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▓▒▒▒▒▒▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░\n\
░░░░░▓▓▓▓▓▓▓▓▓▓▓▒░░░░▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░\n\
░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▓▓▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░░\n\
░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒░▒▓▒▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░\n\
░░░░░░░▒▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░▓▓▓▒▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░\n\
░░░░░░░░▒▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░▒▓▒░░▒▓▓▒▒▒▒▒▒▓▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒▒░░░░▒▓▒░░░░░░░▒▓▓▒▒▒▒▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░▒▓▓▓▓▓▓▓▒▒▒▓▓▓▓▓▓▓▓▓▒░░░░░░░▒▓▒░░░░░░░░░░░▒▓▓▒▒▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░▒▒▓▓▒░░░░░░░░░░░░░░░░░▒▓▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░▒▓▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░▒░░░░░░░░░░░░░░\n\
░░░░░░░▒▒▓▒▒▒▒▒▒▒▒▒▒▒▒▓▒░░▒▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▓▓▒░░░░▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░▒▒▓▓▓▓▓▓▒▒▒░░░░░░░▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n";

    std::string name =
        " ________  ___  ________   ________                 ________  ________  ________   "
        "|\\   ___ \\|\\  \\|\\   ___  \\|\\   __  \\               |\\   ____\\|\\   __  \\|\\   __  \\  "
        "\\ \\  \\_|\\ \\ \\  \\ \\  \\ \\  \\ \\  \\|\\  \\  ____________\\ \\  \\___|\\ \\  \\|\\  \\ \\  \\|\\  \\ "
        " \\ \\  \\ \\ \\ \\  \\ \\  \\ \\  \\ \\  \\\\  \\|\\____________\\ \\  \\    \\ \\   ____\\ \\   ____\\"
        "  \\ \\  \\_\\ \\ \\  \\ \\  \\ \\  \\ \\  \\\\  \\|____________|\\ \\  \\____\\ \\  \\___|\\ \\  \\___|"
        "   \\ \\_______\\ \\__\\ \\__\\ \\__\\ \\_______\\              \\ \\_______\\ \\__\\    \\ \\__\\   "
        "    \\|_______|\\|__|\\|__| \\|__|\\|_______|               \\|_______|\\|__|     \\|__|   "
        "                                                                                   "
        "                                                                                   "
        "                                                                                   "
        "                                                        C++ Modern Web Framework";
    std::cout << logo << std::endl;
    std::cout << name << std::endl;
}

void MosaApp::bind(int port, std::string baseUrl = "www")
{
    this->server = new Mongoose::Server(port, baseUrl.c_str());
    this->server->start();
    std::cout << "Server started at port " << port << " with base name /" << baseUrl << std::endl;
    std::cout << "Loading app API" << std::endl;
    while (true)
    {
        this_thread::sleep_for(chrono::milliseconds(500));
    }
}