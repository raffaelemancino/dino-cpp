#include "app.hpp"

using namespace Mosasaurus;

MosaApp *MosaApp::app = nullptr;

MosaApp::MosaApp()
{
    this->startupLogo();
    std::cout << "App Init" << std::endl;
}

MosaApp *MosaApp::getInstance()
{
    if (!app)
    {
        app = new MosaApp();
    }
    return app;
}

Mongoose::Server *MosaApp::getServerInstance()
{
    if (this->server)
    {
        return this->server;
    }
    else
    {
        std::invalid_argument("Server uninitialized");
        return nullptr;
    }
}

void MosaApp::startupLogo()
{
    std::string logo = "░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▓▓▓▒░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▓▒▒▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░▒░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▓▓▒░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░▒▓▓▓░░░▒▒▓▓▓▒░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░▒▓▓▓▓▒▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▒▓▒▒▓▒▒▒▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░▓▓▓▒░▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▓▒▒▒▒▒▒▓▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▓▓▓▒░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▓▒▒▓▒░░░░░░░░░░░░░░▒░░░░\n\
░░░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░▓▓▒▓▒▒▒▒▓▓▓▓▓▓▓▒▒▓▒░▒▓▒▒▓▓▓▓▒░░░\n\
░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓░░░\n\
░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░░░\n\
░░░░░▒▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒▒▒▓▓▒▒░░░░░░░░░\n\
░░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▒░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░░░░░░░░░░░░░░░\n\
░░░░▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░\n\
░░░▒▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░\n\
░░░░▒▓▓▓▓▓▓▓▓▓░░░░░░░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▓▒▒▒▒▒▓▓▓▓▓▓▓▓▓▒░░░░░░░░░░░░\n\
░░░░░▓▓▓▓▓▓▓▓▓▓▓▒░░░░▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▒░░░░░░░░░░░\n\
░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▓▓▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░░\n\
░░░░░░▒▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒░▒▓▒▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░░\n\
░░░░░░░▒▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░▓▓▓▒▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░░░░░\n\
░░░░░░░░▒▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒░░▒▓▒░░▒▓▓▒▒▒▒▒▒▓▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▒▒░░░░▒▓▒░░░░░░░▒▓▓▒▒▒▒▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░▒▓▓▓▓▓▓▓▒▒▒▓▓▓▓▓▓▓▓▓▒░░░░░░░▒▓▒░░░░░░░░░░░▒▓▓▒▒▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░▒▒▓▓▒▒▒▒▒▒▒▒▓▒░░░░░░░░░░▒▒▓▓▒░░░░░░░░░░░░░░░░░▒▓▓░░░░░░░░░░░░░░\n\
░░░░░░░░░░▒▓▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░▒░░░░░░░░░░░░░░\n\
░░░░░░░▒▒▓▒▒▒▒▒▒▒▒▒▒▒▒▓▒░░▒▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░▒▓▓▒▒▒▒▒▒▒▒▒▒▒▓▓▒░░░░▓▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░▒▒▓▓▓▓▓▓▒▒▒░░░░░░░▓▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n\
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n";

    std::string name = "  __  __                                                                   \n\
 |  \\/  |                                                        _     _   \n\
 | \\  / | ___  ___  __ _ ___  __ _ _   _ _ __ _   _ ___    ___ _| |_ _| |_ \n\
 | |\\/| |/ _ \\/ __|/ _` / __|/ _` | | | | '__| | | / __|  / __|_   _|_   _|\n\
 | |  | | (_) \\__ \\ (_| \\__ \\ (_| | |_| | |  | |_| \\__ \\ | (__  |_|   |_|  \n\
 |_|  |_|\\___/|___/\\__,_|___/\\__,_|\\__,_|_|   \\__,_|___/  \\___|            \n\
                                                        C++ Modern Web Framework";
    std::cout << logo << std::endl;
    std::cout << name << std::endl;
}

void MosaApp::bind(int port, std::string baseUrl = "www")
{
    this->server = new Mongoose::Server(port, baseUrl.c_str());
    this->server->start();
    std::cout << "Server started at port " << port << " with base name /" << baseUrl << std::endl;
    while (true)
    {
        this_thread::sleep_for(chrono::milliseconds(500));
    }
}